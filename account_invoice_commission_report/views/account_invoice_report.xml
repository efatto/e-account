<?xml version="1.0" encoding="utf-8"?>
<openerp>
<data>

<template id="account_invoice_commission_report.commission_layout">
    <t t-set="company" t-value="res_company" />
    <t t-call="report.external_layout_header" />
    <t t-raw="0" />
</template>

<template id="account_invoice_commission_report.report_account_invoice">
    <style type="text/css">
        .left_with_line {
            text-align:left; vertical-align:text-top; border-collapse:collapse; border:1px solid #A1A1A1; padding:5px; font-size: 10px;
        }
        .right_with_line {
            text-align:right; vertical-align:text-top; border-collapse:collapse; border:1px solid #A1A1A1; padding:5px; font-size: 10px;
        }
        .left_with_line_bold {
            text-align:left; vertical-align:text-top; border-collapse:collapse; border:1px solid #A1A1A1; padding:5px; font-weight: bold; font-size: 10px;
        }
        .right_with_line_bold {
            text-align:right; vertical-align:text-top; border-collapse:collapse; border:1px solid #A1A1A1; padding:5px; font-weight: bold; font-size: 10px;
        }
        .first_th_row {
            text-align:center; border:1px solid #A1A1A1; border-collapse:collapse; background: #fff; font-size: 10px;
        }
        .commission_title {
            font-size: 15px;
            font-weight: bold;
            padding-bottom:3px;
            margin-bottom:5px;
            text-align:center;
            }
    </style>
    <t t-call="report.html_container">
    <t t-call="account_invoice_commission_report.commission_layout">
    <div class="page">
        <div id="commission_title">
            <p class="commission_title">
                Report Invoice Commission <span t-esc="agent"/>
            </p>
            <p class="commission_title">

            </p>
            <p class="commission_title">
                <span t-esc="month"/>
            </p>
        </div>
        <table class="table" cellspacing="0">
            <thead>
                <tr class="first_th_row">
                    <th class="left_with_line_bold">INVOICE N.</th>
                    <th class="left_with_line_bold">DATE</th>
                    <th class="left_with_line_bold">PARTNER</th>
                    <th class="right_with_line_bold">INVOICE</th>
                    <th class="right_with_line_bold">NET INVOICE</th>
                    <th class="right_with_line_bold">COMMISSION</th>
                </tr>
            </thead>
            <tbody>
                <t t-set="tot_amount_untaxed" t-value="0" />
                <t t-set="tot_amount_base" t-value="0" />
                <t t-set="tot_amount_commission" t-value="0" />
                <t t-foreach="docs" t-as="o">
                    <tr>
                        <td class="left_with_line"><span t-field="o.number"/></td>
                        <td class="left_with_line"><div style="page-break-inside: avoid" t-field="o.date_invoice"/></td>
                        <td class="left_with_line"><span t-field="o.partner_id.name"/></td>
                        <td class="right_with_line"><span t-field="o.amount_untaxed" t-field-options='{"widget": "monetary", "display_currency": "o.company_id.currency_id"}'/></td>
                        <td class="right_with_line"><span t-esc="sum(x.price_subtotal_signed for x in o.invoice_line if not x.commission_free and not x.advance_invoice_id)"
                                                          t-esc-options='{"widget": "monetary", "display_currency": "o.company_id.currency_id"}'/></td>
                        <td class="right_with_line"><span t-esc="sum(x.price_subtotal_signed * x.invoice_id.partner_id.agents[0].commission.fix_qty/100.0 for x in o.invoice_line if not x.commission_free and not x.advance_invoice_id)"
                                                          t-esc-options='{"widget": "monetary", "display_currency": "o.company_id.currency_id"}'/></td>
                        <t t-set="tot_amount_untaxed" t-value="tot_amount_untaxed + o.amount_untaxed" />
                        <t t-set="tot_amount_base" t-value="tot_amount_base + sum(x.price_subtotal_signed for x in o.invoice_line if not x.commission_free and not x.advance_invoice_id)" />
                        <t t-set="tot_amount_commission" t-value="tot_amount_commission + sum(x.price_subtotal_signed * x.invoice_id.partner_id.agents[0].commission.fix_qty/100.0 for x in o.invoice_line if not x.commission_free and not x.advance_invoice_id)" />
                    </tr>
                </t>
                <tr>
                    <td colspan="3" class="left_with_line_bold">TOTAL</td>
                    <td class="right_with_line_bold"><span t-esc="tot_amount_untaxed" t-esc-options='{"widget": "monetary", "display_currency": "docs[0].company_id.currency_id"}'/></td>
                    <td class="right_with_line_bold"><span t-esc="tot_amount_base" t-esc-options='{"widget": "monetary", "display_currency": "docs[0].company_id.currency_id"}'/></td>
                    <td class="right_with_line_bold"><span t-esc="tot_amount_commission" t-esc-options='{"widget": "monetary", "display_currency": "docs[0].company_id.currency_id"}'/></td>
                </tr>
                <tr>
                    <td colspan="5" class="left_with_line_bold">TOTAL COMMISSION</td>
                    <td class="right_with_line_bold"><span t-esc="tot_amount_commission" t-esc-options='{"widget": "monetary", "display_currency": "docs[0].company_id.currency_id"}'/></td>
                </tr>
            </tbody>
        </table>
    </div>
    </t>
    </t>
</template>     

</data>
</openerp>
